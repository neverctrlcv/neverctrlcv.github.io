import{r as i,j as s,N as X}from"./index-zhzcQSfJ.js";import{M as u}from"./MusicConfig-hKZeYEjk.js";import{s as q}from"./index-tMCrjSUJ.js";const z="/assets/music-hall-logo-uHsBZ51z.png";function _(){var T,L;const R="/music/cover/",[B,w]=i.useState("全部歌曲"),[r,y]=i.useState([]),[$,h]=i.useState(-1),a=i.useRef(new Map),[M,p]=i.useState(""),[A,x]=i.useState(u["music-list"][0]),n=i.useRef(null),v=i.useRef(null),[g,d]=i.useState(0),[j,S]=i.useState(!1);i.useEffect(()=>{var f;const{musicId:e}=q.getState().music;h(e),p(`${u["base-url"]}m-${e}.ogg`);const t=u["music-list"];t.forEach(c=>{c.id===e&&x(c)}),y(t),a.current.set("全部歌曲",t),t.forEach(c=>{const m=c.type.split(" ").join("");if(m.includes(","))m.split(",").forEach(N=>{if(a.current.has(N)){const b=a.current.get(N);b.push(c),a.current.set(N,b)}else{const b=[c];a.current.set(N,b)}});else if(a.current.has(m)){const o=a.current.get(m);o.push(c),a.current.set(m,o)}else{const o=[c];a.current.set(m,o)}});const l=()=>{if(n.current){const c=n.current.currentTime,m=n.current.duration,o=c/m*100;d(o)}};return(f=n.current)==null||f.addEventListener("timeupdate",l),()=>{var c;y([]),a.current.clear(),(c=n.current)==null||c.removeEventListener("timeupdate",l)}},[]),i.useEffect(()=>{g>=100&&k()},[g]);function E(){S(!j)}function P(e){const t=e.target;if(t.tagName==="I")switch(t.className){case"prev":F();break;case"pause-play":E();break;case"next":k();break;default:E()}}i.useEffect(()=>{n.current&&(n.current.loop=r.length<=1)},[r]),i.useEffect(()=>{var e,t;j?(e=n.current)==null||e.play():(t=n.current)==null||t.pause()},[j,M]);function F(){for(let e=0;e<r.length;e++)if(r[e].id==$){let t;e==0?t=r[r.length-1]:t=r[e-1],h(t.id),x(t),p(`${u["base-url"]}m-${t.id}.ogg`),d(0);break}}function k(){let e=0;for(;e<r.length;e++)if(r[e].id==$){let t;e==r.length-1?t=r[0]:t=r[e+1],h(t.id),x(t),p(`${u["base-url"]}m-${t.id}.ogg`),d(0);break}e===r.length&&(h(r[0].id),x(r[0]),p(`${u["base-url"]}m-${r[0].id}.ogg`),d(0))}function H(e){if(e!==B){const t=a.current.get(e);y(t),w(e)}}function C(e){var c,m;const t=((c=v.current)==null?void 0:c.getBoundingClientRect().width)||0,l=((m=v.current)==null?void 0:m.getBoundingClientRect().x)||0,f=e.clientX;d((f-l)/t*100),n.current&&(n.current.currentTime=(f-l)/t*n.current.duration)}function I(e){if(typeof e>"u"||isNaN(e))return"00:00";let t=Math.floor(e%60),l=Math.floor(e/60);return t=t<10?"0"+t:t,l=l<10?"0"+l:l,`${l}：${t}`}function U(e){h(e),r.map(t=>{t.id==e&&x(t)}),p(`${u["base-url"]}m-${e}.ogg`),d(0),S(!0)}return s.jsxs(s.Fragment,{children:[s.jsx("header",{id:"mh-header",children:s.jsxs("div",{className:"mh-header-box",children:[s.jsx("div",{className:"mh-header-left",children:s.jsx("img",{src:z,alt:"logo"})}),s.jsx("div",{className:"mh-header-right",children:s.jsx(X,{to:"/",className:"link-class",children:"首页"})})]})}),s.jsxs("main",{id:"mh-main",children:[s.jsxs("section",{className:"mh-bg-mask",children:[s.jsx("div",{className:"mh-bg bg-setting"}),s.jsx("div",{className:"mh-mask bg-setting"})]}),s.jsx("section",{className:"mg-music-types",children:s.jsx("div",{className:"mh-types-box",children:s.jsx("div",{className:"mh-types-list",children:Array.from(a.current.keys()).map((e,t)=>s.jsxs("div",{className:"mh-types-item",onClick:()=>H(e),children:[s.jsx("div",{className:"mh-types-cover",children:s.jsx("img",{src:`${R}${e}.png`,alt:e})}),s.jsx("div",{className:"mh-types-name",children:s.jsx("span",{children:e})})]},t))})})}),s.jsx("section",{className:"mh-current-musics",children:s.jsx("div",{className:"mh-current-box",children:r.map(e=>s.jsx("div",{className:"mh-current-item",onClick:()=>{U(e.id)},children:s.jsxs("div",{className:"mh-current-item-info",children:[s.jsx("span",{children:e.name.split("-")[0]}),s.jsx("span",{children:e.name.split("-")[1]})]})},e.id))})}),s.jsx("section",{className:"mh-music-player",children:s.jsxs("div",{className:"mh-music-player-box",children:[s.jsx("div",{className:"mh-audio-player",children:s.jsx("audio",{src:M,ref:n})}),s.jsxs("div",{className:"mh-music-progress-bar",children:[s.jsxs("div",{className:"mh-music-progress-bar-top",children:[s.jsx("span",{children:A.name}),s.jsxs("span",{children:[I((T=n.current)==null?void 0:T.currentTime)," / ",I((L=n.current)==null?void 0:L.duration)]})]}),s.jsxs("div",{className:"mh-music-progress-bar-bottom",children:[s.jsx("div",{className:"mh-all-progress-bar",onClick:e=>{C(e)},ref:v}),s.jsx("div",{style:{width:`${g}%`},onClick:e=>{C(e)},className:"mh-played-progress-bar"}),s.jsx("div",{style:{left:`${g}%`},className:"mh-player-cursor"})]})]}),s.jsxs("div",{className:"mh-music-controls",onClick:e=>P(e),children:[s.jsx("div",{className:"mh-btn-prev",children:s.jsx("i",{className:"prev"})}),s.jsx("div",{className:j?"mh-btn-pause":"mh-btn-play",children:s.jsx("i",{className:"pause-play"})}),s.jsx("div",{className:"mh-btn-next",children:s.jsx("i",{className:"next"})})]})]})})]}),s.jsx("footer",{id:"mh-footer",children:s.jsx("div",{className:"mh-copyright",children:s.jsx("span",{children:"copyright by runhuo"})})})]})}export{_ as default};
